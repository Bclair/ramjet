<!doctype html>
<html>
	<head>
		<title>ramjet tests</title>

		<style>
			body {
				font-family: 'arial';
				max-width: 800px;
				padding: 0 2em;
				margin: 0 auto;
				overflow-x: visible;
			}

			article {
				position: relative;
				width: 100%;
				border-bottom: 1px solid #eee;
			}

			article::before, article::after {
				content: ' ';
				display: table;
			}

			article::after {
				clear: both;
			}

			.controls {
				display: block;
			}

			button {
				padding: 1em 2em;
				background-color: #eee;
				border: none;
				font-family: inherit;
				font-size: inherit;
				margin: 0 0 1em 0;
				cursor: pointer;
				color: #666;
				outline: none;
			}

			button:hover {
				background-color: #ddd;
				color: #333;
			}

			button:disabled {
				background-color: #eee;
				color: #666;
				opacity: 0.2;
				cursor: default;
			}

			.test-area {
				position: relative;
			}

			.a, .b {
	position: relative;
	width: 100px;
	height: 100px;
	line-height: 100px;
	color: white;
	text-align: center;
	font-size: 2em;
	box-sizing: border-box;
}

.a {
	float: left;
	background-color: #0074D9;
	border-color: #0074D9;
	fill: #0074D9;
}

.b {
	float: right;
	background-color: #01FF70;
	border-color: #01FF70;
	fill: #01FF70;
}

text {
	fill: white;
}

.container {
	position: absolute;
}

.transform-helper {
	position: absolute;
	left: 0;
	top: 0;
	right: 0;
	bottom: 0;
	border: 2px solid red;
	transition: all 0.6s ease-out;
}

.transform-helper-bg {
	position: absolute;
	width: 100px;
	height: 100px;
	border: 2px solid #999;
	box-sizing: border-box;
}

.screenshots {
	clear: both;
}

.screenshot-column {
	width: 33.333%;
	max-width: 200px;
	float: left;
	padding: 0 1em 0 0;
	box-sizing: border-box;
}

.screenshot-column img {
	width: 100%;
}

		</style>

		<script src='data:application/javascript;base64,KGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHsKICAgICAgICAgICAgdHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnID8gbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCkgOgogICAgICAgICAgICB0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQgPyBkZWZpbmUoZmFjdG9yeSkgOgogICAgICAgICAgICAoZ2xvYmFsLnJhbWpldCA9IGZhY3RvcnkoKSk7Cn0odGhpcywgZnVuY3Rpb24gKCkgeyAndXNlIHN0cmljdCc7CgogICAgICAgICAgICB2YXIgYmFiZWxIZWxwZXJzID0ge307CgogICAgICAgICAgICBiYWJlbEhlbHBlcnMuY2xhc3NDYWxsQ2hlY2sgPSBmdW5jdGlvbiAoaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7CiAgICAgICAgICAgICAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGJhYmVsSGVscGVycy5jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsKICAgICAgICAgICAgICAgICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwogICAgICAgICAgICAgICAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgIGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogICAgICAgICAgICAgICAgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICAgICAgICAgICAgICAgIGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOwogICAgICAgICAgICAgICAgcmV0dXJuIENvbnN0cnVjdG9yOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0oKTsKCiAgICAgICAgICAgIGJhYmVsSGVscGVycy5zbGljZWRUb0FycmF5ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIGZ1bmN0aW9uIHNsaWNlSXRlcmF0b3IoYXJyLCBpKSB7CiAgICAgICAgICAgICAgICB2YXIgX2FyciA9IFtdOwogICAgICAgICAgICAgICAgdmFyIF9uID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHZhciBfZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdmFyIF9lID0gdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9pID0gYXJyW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3M7ICEoX24gPSAoX3MgPSBfaS5uZXh0KCkpLmRvbmUpOyBfbiA9IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBfYXJyLnB1c2goX3MudmFsdWUpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICBfZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIF9lID0gZXJyOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBpZiAoIV9uICYmIF9pWyJyZXR1cm4iXSkgX2lbInJldHVybiJdKCk7CiAgICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9kKSB0aHJvdyBfZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfYXJyOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhcnIsIGkpIHsKICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGFycikpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGFycjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChhcnIpKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBzbGljZUl0ZXJhdG9yKGFyciwgaSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSgpOwoKICAgICAgICAgICAgYmFiZWxIZWxwZXJzOwoKICAgICAgICAgICAgZnVuY3Rpb24gaGlkZU5vZGUobm9kZSkgewogICAgICAgICAgICAJbm9kZS5fX3JhbWpldE9yaWdpbmFsVHJhbnNpdGlvbl9fID0gbm9kZS5zdHlsZS53ZWJraXRUcmFuc2l0aW9uIHx8IG5vZGUuc3R5bGUudHJhbnNpdGlvbjsKICAgICAgICAgICAgCW5vZGUuX19yYW1qZXRPcmlnaW5hbE9wYWNpdHlfXyA9IG5vZGUuc3R5bGUub3BhY2l0eTsKCiAgICAgICAgICAgIAlub2RlLnN0eWxlLndlYmtpdFRyYW5zaXRpb24gPSBub2RlLnN0eWxlLnRyYW5zaXRpb24gPSAnJzsKCiAgICAgICAgICAgIAlub2RlLnN0eWxlLm9wYWNpdHkgPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBzaG93Tm9kZShub2RlKSB7CiAgICAgICAgICAgIAlpZiAoJ19fcmFtamV0T3JpZ2luYWxPcGFjaXR5X18nIGluIG5vZGUpIHsKICAgICAgICAgICAgCQlub2RlLnN0eWxlLnRyYW5zaXRpb24gPSAnJzsKICAgICAgICAgICAgCQlub2RlLnN0eWxlLm9wYWNpdHkgPSBub2RlLl9fcmFtamV0T3JpZ2luYWxPcGFjaXR5X187CgogICAgICAgICAgICAJCWlmIChub2RlLl9fcmFtamV0T3JpZ2luYWxUcmFuc2l0aW9uX18pIHsKICAgICAgICAgICAgCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIAkJCQlub2RlLnN0eWxlLnRyYW5zaXRpb24gPSBub2RlLl9fcmFtamV0T3JpZ2luYWxUcmFuc2l0aW9uX187CiAgICAgICAgICAgIAkJCX0pOwogICAgICAgICAgICAJCX0KICAgICAgICAgICAgCX0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gY2xvbmVOb2RlKG5vZGUpIHsKICAgICAgICAgICAgCXZhciBjbG9uZSA9IG5vZGUuY2xvbmVOb2RlKCk7CgogICAgICAgICAgICAJaWYgKG5vZGUubm9kZVR5cGUgPT09IDEpIHsKICAgICAgICAgICAgCQljbG9uZS5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgd2luZG93LmdldENvbXB1dGVkU3R5bGUobm9kZSkuY3NzVGV4dCk7CgogICAgICAgICAgICAJCXZhciBsZW4gPSBub2RlLmNoaWxkTm9kZXMubGVuZ3RoOwogICAgICAgICAgICAJCXZhciBpID0gdW5kZWZpbmVkOwoKICAgICAgICAgICAgCQlmb3IgKGkgPSAwOyBpIDwgbGVuOyBpICs9IDEpIHsKICAgICAgICAgICAgCQkJY2xvbmUuYXBwZW5kQ2hpbGQoY2xvbmVOb2RlKG5vZGUuY2hpbGROb2Rlc1tpXSkpOwogICAgICAgICAgICAJCX0KICAgICAgICAgICAgCX0KCiAgICAgICAgICAgIAlyZXR1cm4gY2xvbmU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBiZ0NvbG9yUmVnZXhwID0gL15yZ2JhP1woKFxkKyksXHMqKFxkKyksXHMqKFxkKykoPzosXHMqKFxkPy5cZCspKT9cKSQvOwoKICAgICAgICAgICAgZnVuY3Rpb24gcGFyc2VDb2xvcihzdHIpIHsKICAgICAgICAgICAgCXZhciBtYXRjaCA9IGJnQ29sb3JSZWdleHAuZXhlYyhzdHIpOwoKICAgICAgICAgICAgCWlmICghbWF0Y2gpIHJldHVybiBudWxsOwoKICAgICAgICAgICAgCXJldHVybiB7CiAgICAgICAgICAgIAkJcjogK21hdGNoWzFdLAogICAgICAgICAgICAJCWc6ICttYXRjaFsyXSwKICAgICAgICAgICAgCQliOiArbWF0Y2hbM10sCiAgICAgICAgICAgIAkJYWxwaGE6IG1hdGNoWzRdID8gK21hdGNoWzRdIDogMQogICAgICAgICAgICAJfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGJvcmRlclJhZGl1c1JlZ2V4ID0gL14oXGQrKXB4KD86IChcZCspcHgpPyQvOwoKICAgICAgICAgICAgZnVuY3Rpb24gcGFyc2VCb3JkZXJSYWRpdXMoc3RyKSB7CiAgICAgICAgICAgIAl2YXIgbWF0Y2ggPSBib3JkZXJSYWRpdXNSZWdleC5leGVjKHN0cik7CgogICAgICAgICAgICAJcmV0dXJuIG1hdGNoWzJdID8geyB4OiArbWF0Y2hbMV0sIHk6ICttYXRjaFsyXSB9IDogeyB4OiArbWF0Y2hbMV0sIHk6ICttYXRjaFsxXSB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgc3ZnbnMgPSAnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnOwoKICAgICAgICAgICAgZnVuY3Rpb24gZmluZFBhcmVudEJ5VGFnTmFtZShub2RlLCB0YWdOYW1lKSB7CiAgICAgICAgICAgIAl3aGlsZSAobm9kZSkgewogICAgICAgICAgICAJCWlmIChub2RlLnRhZ05hbWUgPT09IHRhZ05hbWUpIHsKICAgICAgICAgICAgCQkJcmV0dXJuIG5vZGU7CiAgICAgICAgICAgIAkJfQoKICAgICAgICAgICAgCQlub2RlID0gbm9kZS5wYXJlbnROb2RlOwogICAgICAgICAgICAJfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBmaW5kVHJhbnNmb3JtUGFyZW50KG5vZGUpIHsKICAgICAgICAgICAgCXZhciBpc1N2ZyA9IG5vZGUubmFtZXNwYWNlVVJJID09PSBzdmducyAmJiBub2RlLnRhZ05hbWUgIT09ICdzdmcnOwogICAgICAgICAgICAJcmV0dXJuIGlzU3ZnID8gZmluZFBhcmVudEJ5VGFnTmFtZShub2RlLCAnc3ZnJykgOiBub2RlLnBhcmVudE5vZGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCiAgICAgICAgICAgIHZhciBrZXlmcmFtZXNTdXBwb3J0ZWQgPSB0cnVlOwogICAgICAgICAgICB2YXIgVFJBTlNGT1JNID0gdW5kZWZpbmVkOwogICAgICAgICAgICB2YXIgVFJBTlNGT1JNX09SSUdJTiA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgdmFyIFRSQU5TRk9STV9DU1MgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIHZhciBLRVlGUkFNRVMgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIHZhciBBTklNQVRJT04gPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIHZhciBBTklNQVRJT05fRElSRUNUSU9OID0gdW5kZWZpbmVkOwogICAgICAgICAgICB2YXIgQU5JTUFUSU9OX0RVUkFUSU9OID0gdW5kZWZpbmVkOwogICAgICAgICAgICB2YXIgQU5JTUFUSU9OX0lURVJBVElPTl9DT1VOVCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgdmFyIEFOSU1BVElPTl9OQU1FID0gdW5kZWZpbmVkOwogICAgICAgICAgICB2YXIgQU5JTUFUSU9OX1RJTUlOR19GVU5DVElPTiA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgdmFyIEFOSU1BVElPTl9FTkQgPSB1bmRlZmluZWQ7CgogICAgICAgICAgICAvLyBXZSBoYXZlIHRvIGJyb3dzZXItc25pZmYgZm9yIElFMTEsIGJlY2F1c2UgaXQgd2FzIGFwcGFyZW50bHkgd3JpdHRlbgogICAgICAgICAgICAvLyBieSBhIGJhcnJlbCBvZiBzdG9uZWQgbW9ua2V5cyAtIGh0dHA6Ly9qc2ZpZGRsZS5uZXQvcmljaF9oYXJyaXMvb3F1THUycUwvCgogICAgICAgICAgICAvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE3OTA3NDQ1L2hvdy10by1kZXRlY3QtaWUxMQogICAgICAgICAgICB2YXIgaXNJZTExID0gIXdpbmRvdy5BY3RpdmVYT2JqZWN0ICYmICdBY3RpdmVYT2JqZWN0JyBpbiB3aW5kb3c7CgogICAgICAgICAgICBpZiAoIWlzSWUxMSAmJiAoJ3RyYW5zZm9ybScgaW4gZGl2LnN0eWxlIHx8ICd3ZWJraXRUcmFuc2Zvcm0nIGluIGRpdi5zdHlsZSkgJiYgKCdhbmltYXRpb24nIGluIGRpdi5zdHlsZSB8fCAnd2Via2l0QW5pbWF0aW9uJyBpbiBkaXYuc3R5bGUpKSB7CiAgICAgICAgICAgIAlrZXlmcmFtZXNTdXBwb3J0ZWQgPSB0cnVlOwoKICAgICAgICAgICAgCWlmICgnd2Via2l0VHJhbnNmb3JtJyBpbiBkaXYuc3R5bGUpIHsKICAgICAgICAgICAgCQlUUkFOU0ZPUk0gPSAnd2Via2l0VHJhbnNmb3JtJzsKICAgICAgICAgICAgCQlUUkFOU0ZPUk1fQ1NTID0gJy13ZWJraXQtdHJhbnNmb3JtJzsKICAgICAgICAgICAgCQlUUkFOU0ZPUk1fT1JJR0lOID0gJ3dlYmtpdFRyYW5zZm9ybU9yaWdpbic7CiAgICAgICAgICAgIAl9IGVsc2UgewogICAgICAgICAgICAJCVRSQU5TRk9STSA9IFRSQU5TRk9STV9DU1MgPSAndHJhbnNmb3JtJzsKICAgICAgICAgICAgCQlUUkFOU0ZPUk1fT1JJR0lOID0gJ3RyYW5zZm9ybU9yaWdpbic7CiAgICAgICAgICAgIAl9CgogICAgICAgICAgICAJaWYgKCdhbmltYXRpb24nIGluIGRpdi5zdHlsZSkgewogICAgICAgICAgICAJCUtFWUZSQU1FUyA9ICdAa2V5ZnJhbWVzJzsKCiAgICAgICAgICAgIAkJQU5JTUFUSU9OID0gJ2FuaW1hdGlvbic7CiAgICAgICAgICAgIAkJQU5JTUFUSU9OX0RJUkVDVElPTiA9ICdhbmltYXRpb25EaXJlY3Rpb24nOwogICAgICAgICAgICAJCUFOSU1BVElPTl9EVVJBVElPTiA9ICdhbmltYXRpb25EdXJhdGlvbic7CiAgICAgICAgICAgIAkJQU5JTUFUSU9OX0lURVJBVElPTl9DT1VOVCA9ICdhbmltYXRpb25JdGVyYXRpb25Db3VudCc7CiAgICAgICAgICAgIAkJQU5JTUFUSU9OX05BTUUgPSAnYW5pbWF0aW9uTmFtZSc7CiAgICAgICAgICAgIAkJQU5JTUFUSU9OX1RJTUlOR19GVU5DVElPTiA9ICdhbmltYXRpb25UaW1pbmdGdW5jdGlvbic7CgogICAgICAgICAgICAJCUFOSU1BVElPTl9FTkQgPSAnYW5pbWF0aW9uZW5kJzsKICAgICAgICAgICAgCX0gZWxzZSB7CiAgICAgICAgICAgIAkJS0VZRlJBTUVTID0gJ0Atd2Via2l0LWtleWZyYW1lcyc7CgogICAgICAgICAgICAJCUFOSU1BVElPTiA9ICd3ZWJraXRBbmltYXRpb24nOwogICAgICAgICAgICAJCUFOSU1BVElPTl9ESVJFQ1RJT04gPSAnd2Via2l0QW5pbWF0aW9uRGlyZWN0aW9uJzsKICAgICAgICAgICAgCQlBTklNQVRJT05fRFVSQVRJT04gPSAnd2Via2l0QW5pbWF0aW9uRHVyYXRpb24nOwogICAgICAgICAgICAJCUFOSU1BVElPTl9JVEVSQVRJT05fQ09VTlQgPSAnd2Via2l0QW5pbWF0aW9uSXRlcmF0aW9uQ291bnQnOwogICAgICAgICAgICAJCUFOSU1BVElPTl9OQU1FID0gJ3dlYmtpdEFuaW1hdGlvbk5hbWUnOwogICAgICAgICAgICAJCUFOSU1BVElPTl9USU1JTkdfRlVOQ1RJT04gPSAnd2Via2l0QW5pbWF0aW9uVGltaW5nRnVuY3Rpb24nOwoKICAgICAgICAgICAgCQlBTklNQVRJT05fRU5EID0gJ3dlYmtpdEFuaW1hdGlvbkVuZCc7CiAgICAgICAgICAgIAl9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIAlrZXlmcmFtZXNTdXBwb3J0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIElERU5USVRZID0gWzEsIDAsIDAsIDEsIDAsIDBdOwoKICAgICAgICAgICAgZnVuY3Rpb24gbXVsdGlwbHkoX3JlZiwgX3JlZjIpIHsKICAgICAgICAgICAgCXZhciBfcmVmNCA9IGJhYmVsSGVscGVycy5zbGljZWRUb0FycmF5KF9yZWYsIDYpOwoKICAgICAgICAgICAgCXZhciBhMSA9IF9yZWY0WzBdOwogICAgICAgICAgICAJdmFyIGIxID0gX3JlZjRbMV07CiAgICAgICAgICAgIAl2YXIgYzEgPSBfcmVmNFsyXTsKICAgICAgICAgICAgCXZhciBkMSA9IF9yZWY0WzNdOwogICAgICAgICAgICAJdmFyIGUxID0gX3JlZjRbNF07CiAgICAgICAgICAgIAl2YXIgZjEgPSBfcmVmNFs1XTsKCiAgICAgICAgICAgIAl2YXIgX3JlZjMgPSBiYWJlbEhlbHBlcnMuc2xpY2VkVG9BcnJheShfcmVmMiwgNik7CgogICAgICAgICAgICAJdmFyIGEyID0gX3JlZjNbMF07CiAgICAgICAgICAgIAl2YXIgYjIgPSBfcmVmM1sxXTsKICAgICAgICAgICAgCXZhciBjMiA9IF9yZWYzWzJdOwogICAgICAgICAgICAJdmFyIGQyID0gX3JlZjNbM107CiAgICAgICAgICAgIAl2YXIgZTIgPSBfcmVmM1s0XTsKICAgICAgICAgICAgCXZhciBmMiA9IF9yZWYzWzVdOwoKICAgICAgICAgICAgCXJldHVybiBbYTEgKiBhMiArIGMxICogYjIsIC8vIGEKICAgICAgICAgICAgCWIxICogYTIgKyBkMSAqIGIyLCAvLyBiCiAgICAgICAgICAgIAlhMSAqIGMyICsgYzEgKiBkMiwgLy8gYwogICAgICAgICAgICAJYjEgKiBjMiArIGQxICogZDIsIC8vIGQKICAgICAgICAgICAgCWExICogZTIgKyBjMSAqIGYyICsgZTEsIC8vIGUKICAgICAgICAgICAgCWIxICogZTIgKyBkMSAqIGYyICsgZjEgLy8gZgogICAgICAgICAgICAJXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gaW52ZXJ0KF9yZWY1KSB7CiAgICAgICAgICAgIAl2YXIgX3JlZjYgPSBiYWJlbEhlbHBlcnMuc2xpY2VkVG9BcnJheShfcmVmNSwgNik7CgogICAgICAgICAgICAJdmFyIGEgPSBfcmVmNlswXTsKICAgICAgICAgICAgCXZhciBiID0gX3JlZjZbMV07CiAgICAgICAgICAgIAl2YXIgYyA9IF9yZWY2WzJdOwogICAgICAgICAgICAJdmFyIGQgPSBfcmVmNlszXTsKICAgICAgICAgICAgCXZhciBlID0gX3JlZjZbNF07CiAgICAgICAgICAgIAl2YXIgZiA9IF9yZWY2WzVdOwoKICAgICAgICAgICAgCXZhciBkZXRlcm1pbmFudCA9IGEgKiBkIC0gYyAqIGI7CgogICAgICAgICAgICAJcmV0dXJuIFtkIC8gZGV0ZXJtaW5hbnQsIC1iIC8gZGV0ZXJtaW5hbnQsIC1jIC8gZGV0ZXJtaW5hbnQsIGEgLyBkZXRlcm1pbmFudCwgKGMgKiBmIC0gZSAqIGQpIC8gZGV0ZXJtaW5hbnQsIChlICogYiAtIGEgKiBmKSAvIGRldGVybWluYW50XTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gcGFyc2VNYXRyaXhUcmFuc2Zvcm1TdHJpbmcodHJhbnNmb3JtKSB7CiAgICAgICAgICAgIAlpZiAodHJhbnNmb3JtLnNsaWNlKDAsIDcpICE9PSAnbWF0cml4KCcpIHsKICAgICAgICAgICAgCQl0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkIG5vdCBwYXJzZSB0cmFuc2Zvcm0gc3RyaW5nICgnICsgdHJhbnNmb3JtICsgJyknKTsKICAgICAgICAgICAgCX0KCiAgICAgICAgICAgIAlyZXR1cm4gdHJhbnNmb3JtLnNsaWNlKDcsIC0xKS5zcGxpdCgnICcpLm1hcChwYXJzZUZsb2F0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gcGFyc2VUcmFuc2Zvcm1TdHJpbmcodHJhbnNmb3JtKSB7CiAgICAgICAgICAgIAl2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIAlkaXYuc3R5bGUud2Via2l0VHJhbnNmb3JtID0gZGl2LnN0eWxlLnRyYW5zZm9ybSA9IHRyYW5zZm9ybTsKCiAgICAgICAgICAgIAlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRpdik7CiAgICAgICAgICAgIAl2YXIgc3R5bGUgPSBnZXRDb21wdXRlZFN0eWxlKGRpdik7CiAgICAgICAgICAgIAl2YXIgbWF0cml4ID0gcGFyc2VNYXRyaXhUcmFuc2Zvcm1TdHJpbmcoc3R5bGVbVFJBTlNGT1JNXSk7CiAgICAgICAgICAgIAlkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGRpdik7CgogICAgICAgICAgICAJcmV0dXJuIG1hdHJpeDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gZ2V0Q3VtdWxhdGl2ZVRyYW5zZm9ybU1hdHJpeChub2RlKSB7CiAgICAgICAgICAgIAlpZiAobm9kZS5uYW1lc3BhY2VVUkkgPT09IHN2Z25zKSB7CiAgICAgICAgICAgIAkJdmFyIF9ub2RlJGdldENUTSA9IG5vZGUuZ2V0Q1RNKCk7CgogICAgICAgICAgICAJCXZhciBhID0gX25vZGUkZ2V0Q1RNLmE7CiAgICAgICAgICAgIAkJdmFyIGIgPSBfbm9kZSRnZXRDVE0uYjsKICAgICAgICAgICAgCQl2YXIgYyA9IF9ub2RlJGdldENUTS5jOwogICAgICAgICAgICAJCXZhciBkID0gX25vZGUkZ2V0Q1RNLmQ7CiAgICAgICAgICAgIAkJdmFyIGUgPSBfbm9kZSRnZXRDVE0uZTsKICAgICAgICAgICAgCQl2YXIgZiA9IF9ub2RlJGdldENUTS5mOwoKICAgICAgICAgICAgCQlyZXR1cm4gW2EsIGIsIGMsIGQsIGUsIGZdOwogICAgICAgICAgICAJfQoKICAgICAgICAgICAgCXZhciBtYXRyaXggPSBbMSwgMCwgMCwgMSwgMCwgMF07CgogICAgICAgICAgICAJd2hpbGUgKG5vZGUgaW5zdGFuY2VvZiBFbGVtZW50KSB7CiAgICAgICAgICAgIAkJdmFyIGlzU3ZnID0gbm9kZS5uYW1lc3BhY2VVUkkgPT09IHN2Z25zICYmIG5vZGUudGFnTmFtZSAhPT0gJ3N2Zyc7CiAgICAgICAgICAgIAkJdmFyIHBhcmVudE1hdHJpeCA9IGlzU3ZnID8gZ2V0U3ZnVHJhbnNmb3JtTWF0cml4KG5vZGUpIDogZ2V0VHJhbnNmb3JtTWF0cml4KG5vZGUpOwoKICAgICAgICAgICAgCQlpZiAocGFyZW50TWF0cml4KSB7CiAgICAgICAgICAgIAkJCW1hdHJpeCA9IG11bHRpcGx5KHBhcmVudE1hdHJpeCwgbWF0cml4KTsKICAgICAgICAgICAgCQl9CgogICAgICAgICAgICAJCW5vZGUgPSBmaW5kVHJhbnNmb3JtUGFyZW50KG5vZGUpOwogICAgICAgICAgICAJfQoKICAgICAgICAgICAgCXJldHVybiBtYXRyaXg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFRyYW5zZm9ybU1hdHJpeChub2RlKSB7CiAgICAgICAgICAgIAlpZiAobm9kZS5uYW1lc3BhY2VVUkkgPT09IHN2Z25zKSB7CiAgICAgICAgICAgIAkJdmFyIGN0bSA9IGdldEN1bXVsYXRpdmVUcmFuc2Zvcm1NYXRyaXgobm9kZSk7CiAgICAgICAgICAgIAkJdmFyIHBhcmVudENUTSA9IGdldEN1bXVsYXRpdmVUcmFuc2Zvcm1NYXRyaXgobm9kZS5wYXJlbnROb2RlKTsKICAgICAgICAgICAgCQlyZXR1cm4gbXVsdGlwbHkoaW52ZXJ0KHBhcmVudENUTSksIGN0bSk7CiAgICAgICAgICAgIAl9CgogICAgICAgICAgICAJdmFyIHN0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZShub2RlKTsKICAgICAgICAgICAgCXZhciB0cmFuc2Zvcm0gPSBzdHlsZVtUUkFOU0ZPUk1dOwoKICAgICAgICAgICAgCWlmICh0cmFuc2Zvcm0gPT09ICdub25lJykgewogICAgICAgICAgICAJCXJldHVybiBudWxsOwogICAgICAgICAgICAJfQoKICAgICAgICAgICAgCXZhciBvcmlnaW4gPSBzdHlsZVtUUkFOU0ZPUk1fT1JJR0lOXS5zcGxpdCgnICcpLm1hcChwYXJzZUZsb2F0KTsKCiAgICAgICAgICAgIAl2YXIgbWF0cml4ID0gcGFyc2VNYXRyaXhUcmFuc2Zvcm1TdHJpbmcodHJhbnNmb3JtKTsKCiAgICAgICAgICAgIAkvLyBjb21wZW5zYXRlIGZvciB0aGUgdHJhbnNmb3JtIG9yaWdpbiAod2Ugd2FudCB0byBleHByZXNzIGV2ZXJ5dGhpbmcgaW4gWzAsMF0gdGVybXMpCiAgICAgICAgICAgIAltYXRyaXggPSBtdWx0aXBseShbMSwgMCwgMCwgMSwgb3JpZ2luWzBdLCBvcmlnaW5bMV1dLCBtYXRyaXgpOwogICAgICAgICAgICAJbWF0cml4ID0gbXVsdGlwbHkobWF0cml4LCBbMSwgMCwgMCwgMSwgLW9yaWdpblswXSwgLW9yaWdpblsxXV0pOwoKICAgICAgICAgICAgCS8vIFRPRE8gaWYgaXMgU1ZHLCBtdWx0aXBseSBieSBDVE0sIHRvIGFjY291bnQgZm9yIHZpZXdCb3gKCiAgICAgICAgICAgIAlyZXR1cm4gbWF0cml4OwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBnZXRTdmdUcmFuc2Zvcm1NYXRyaXgobm9kZSkgewogICAgICAgICAgICAJLy8gY29uc3QgeyBhLCBiLCBjLCBkLCBlLCBmIH0gPSBub2RlLmdldENUTSgpOwogICAgICAgICAgICAJLy8gcmV0dXJuIFsgYSwgYiwgYywgZCwgZSwgZiBdOwoKICAgICAgICAgICAgCXZhciB0cmFuc2Zvcm0gPSBub2RlLmdldEF0dHJpYnV0ZSgndHJhbnNmb3JtJyk7CiAgICAgICAgICAgIH0KCnZhciBtYXRyaXggPSBPYmplY3QuZnJlZXplKHsKICAgICAgICAgICAgCUlERU5USVRZOiBJREVOVElUWSwKICAgICAgICAgICAgCW11bHRpcGx5OiBtdWx0aXBseSwKICAgICAgICAgICAgCWludmVydDogaW52ZXJ0LAogICAgICAgICAgICAJcGFyc2VNYXRyaXhUcmFuc2Zvcm1TdHJpbmc6IHBhcnNlTWF0cml4VHJhbnNmb3JtU3RyaW5nLAogICAgICAgICAgICAJcGFyc2VUcmFuc2Zvcm1TdHJpbmc6IHBhcnNlVHJhbnNmb3JtU3RyaW5nLAogICAgICAgICAgICAJZ2V0Q3VtdWxhdGl2ZVRyYW5zZm9ybU1hdHJpeDogZ2V0Q3VtdWxhdGl2ZVRyYW5zZm9ybU1hdHJpeCwKICAgICAgICAgICAgCWdldFRyYW5zZm9ybU1hdHJpeDogZ2V0VHJhbnNmb3JtTWF0cml4LAogICAgICAgICAgICAJZ2V0U3ZnVHJhbnNmb3JtTWF0cml4OiBnZXRTdmdUcmFuc2Zvcm1NYXRyaXgKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBmdW5jdGlvbiBnZXRCb3VuZGluZ0NsaWVudFJlY3Qobm9kZSwgaW52ZXJ0ZWRQYXJlbnRDVE0pIHsKICAgICAgICAgICAgCXZhciBvcmlnaW5hbFRyYW5zZm9ybU9yaWdpbiA9IG5vZGUuc3R5bGVbVFJBTlNGT1JNX09SSUdJTl07CiAgICAgICAgICAgIAl2YXIgb3JpZ2luYWxUcmFuc2Zvcm0gPSBub2RlLnN0eWxlW1RSQU5TRk9STV07CiAgICAgICAgICAgIAl2YXIgb3JpZ2luYWxUcmFuc2Zvcm1BdHRyaWJ1dGUgPSBub2RlLmdldEF0dHJpYnV0ZSgndHJhbnNmb3JtJyk7IC8vIFNWRwoKICAgICAgICAgICAgCW5vZGUuc3R5bGVbVFJBTlNGT1JNX09SSUdJTl0gPSAnMCAwJzsKICAgICAgICAgICAgCW5vZGUuc3R5bGVbVFJBTlNGT1JNXSA9ICdtYXRyaXgoJyArIGludmVydGVkUGFyZW50Q1RNLmpvaW4oJywnKSArICcpJzsKCiAgICAgICAgICAgIAl2YXIgYmNyID0gbm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCiAgICAgICAgICAgIAkvLyByZXNldAogICAgICAgICAgICAJbm9kZS5zdHlsZVtUUkFOU0ZPUk1fT1JJR0lOXSA9IG9yaWdpbmFsVHJhbnNmb3JtT3JpZ2luOwogICAgICAgICAgICAJbm9kZS5zdHlsZVtUUkFOU0ZPUk1dID0gb3JpZ2luYWxUcmFuc2Zvcm07CiAgICAgICAgICAgIAlub2RlLnNldEF0dHJpYnV0ZSgndHJhbnNmb3JtJywgb3JpZ2luYWxUcmFuc2Zvcm1BdHRyaWJ1dGUgfHwgJycpOyAvLyBUT0RPIHJlbW92ZSBhdHRyaWJ1dGUgYWx0b2dldGhlciBpZiBudWxsPwoKICAgICAgICAgICAgCXJldHVybiBiY3I7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBIdG1sV3JhcHBlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgCWZ1bmN0aW9uIEh0bWxXcmFwcGVyKG5vZGUsIG9wdGlvbnMpIHsKICAgICAgICAgICAgCQliYWJlbEhlbHBlcnMuY2xhc3NDYWxsQ2hlY2sodGhpcywgSHRtbFdyYXBwZXIpOwoKICAgICAgICAgICAgCQl0aGlzLmluaXQobm9kZSwgb3B0aW9ucyk7CiAgICAgICAgICAgIAl9CgogICAgICAgICAgICAJYmFiZWxIZWxwZXJzLmNyZWF0ZUNsYXNzKEh0bWxXcmFwcGVyLCBbewogICAgICAgICAgICAJCWtleTogJ2luaXQnLAogICAgICAgICAgICAJCXZhbHVlOiBmdW5jdGlvbiBpbml0KG5vZGUpIHsKICAgICAgICAgICAgCQkJdGhpcy5fbm9kZSA9IG5vZGU7CgogICAgICAgICAgICAJCQl0aGlzLl9jbG9uZSA9IGNsb25lTm9kZShub2RlKTsKCiAgICAgICAgICAgIAkJCXZhciBzdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKG5vZGUpOwogICAgICAgICAgICAJCQl0aGlzLnN0eWxlID0gc3R5bGU7CgogICAgICAgICAgICAJCQkvLyB3ZSBuZWVkIHRvIGdldCB0aGUgJ25ha2VkJyBib3VuZGluZ0NsaWVudFJlY3QsIGkuZS4KICAgICAgICAgICAgCQkJLy8gd2l0aG91dCBhbnkgdHJhbnNmb3JtcwogICAgICAgICAgICAJCQl2YXIgcGFyZW50Q1RNID0gbm9kZS5uYW1lc3BhY2VVUkkgPT09ICdzdmcnID8gbm9kZS5wYXJlbnROb2RlLmdldFNjcmVlbkNUTSgpIDogZ2V0Q3VtdWxhdGl2ZVRyYW5zZm9ybU1hdHJpeChub2RlLnBhcmVudE5vZGUpOwogICAgICAgICAgICAJCQl0aGlzLmludmVydGVkUGFyZW50Q1RNID0gaW52ZXJ0KHBhcmVudENUTSk7CiAgICAgICAgICAgIAkJCXRoaXMudHJhbnNmb3JtID0gZ2V0VHJhbnNmb3JtTWF0cml4KG5vZGUpIHx8IElERU5USVRZOwogICAgICAgICAgICAJCQl0aGlzLmN0bSA9IG11bHRpcGx5KHBhcmVudENUTSwgdGhpcy50cmFuc2Zvcm0pOwoKICAgICAgICAgICAgCQkJdmFyIGJjciA9IGdldEJvdW5kaW5nQ2xpZW50UmVjdChub2RlLCB0aGlzLmludmVydGVkUGFyZW50Q1RNKTsKICAgICAgICAgICAgCQkJdGhpcy5iY3IgPSBiY3I7CgogICAgICAgICAgICAJCQl2YXIgb3BhY2l0eSA9ICtzdHlsZS5vcGFjaXR5OwoKICAgICAgICAgICAgCQkJdmFyIHJnYmEgPSBwYXJzZUNvbG9yKHN0eWxlLmJhY2tncm91bmRDb2xvcik7CgogICAgICAgICAgICAJCQkvLyBUT0RPIGNyZWF0ZSBhIGZsYXQgYXJyYXk/IGVhc2llciB0byB3b3JrIHdpdGggbGF0ZXI/CiAgICAgICAgICAgIAkJCXZhciBib3JkZXJSYWRpdXMgPSB7CiAgICAgICAgICAgIAkJCQl0bDogcGFyc2VCb3JkZXJSYWRpdXMoc3R5bGUuYm9yZGVyVG9wTGVmdFJhZGl1cyksCiAgICAgICAgICAgIAkJCQl0cjogcGFyc2VCb3JkZXJSYWRpdXMoc3R5bGUuYm9yZGVyVG9wUmlnaHRSYWRpdXMpLAogICAgICAgICAgICAJCQkJYnI6IHBhcnNlQm9yZGVyUmFkaXVzKHN0eWxlLmJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzKSwKICAgICAgICAgICAgCQkJCWJsOiBwYXJzZUJvcmRlclJhZGl1cyhzdHlsZS5ib3JkZXJCb3R0b21MZWZ0UmFkaXVzKQogICAgICAgICAgICAJCQl9OwoKICAgICAgICAgICAgCQkJdGhpcy5ib3JkZXJSYWRpdXMgPSBib3JkZXJSYWRpdXM7CiAgICAgICAgICAgIAkJCXRoaXMub3BhY2l0eSA9IG9wYWNpdHk7CiAgICAgICAgICAgIAkJCXRoaXMucmdiYSA9IHJnYmE7CgogICAgICAgICAgICAJCQl0aGlzLmxlZnQgPSBiY3IubGVmdDsKICAgICAgICAgICAgCQkJdGhpcy50b3AgPSBiY3IudG9wOwogICAgICAgICAgICAJCQl0aGlzLndpZHRoID0gYmNyLndpZHRoOwogICAgICAgICAgICAJCQl0aGlzLmhlaWdodCA9IGJjci5oZWlnaHQ7CiAgICAgICAgICAgIAkJfQogICAgICAgICAgICAJfSwgewogICAgICAgICAgICAJCWtleTogJ2luc2VydCcsCiAgICAgICAgICAgIAkJdmFsdWU6IGZ1bmN0aW9uIGluc2VydCgpIHsKICAgICAgICAgICAgCQkJdmFyIGJjciA9IHRoaXMuYmNyOwoKICAgICAgICAgICAgCQkJdmFyIGNsb25lID0gdW5kZWZpbmVkOwogICAgICAgICAgICAJCQl2YXIgY29udGFpbmVyID0gdW5kZWZpbmVkOwoKICAgICAgICAgICAgCQkJaWYgKHRoaXMuX25vZGUubmFtZXNwYWNlVVJJID09PSBzdmducykgewogICAgICAgICAgICAJCQkJLy8gVE9ETyB3aGF0IGlmIGl0J3MgdGhlIDxzdmc+IGl0c2VsZiwgbm90IGEgY2hpbGQ/CiAgICAgICAgICAgIAkJCQl2YXIgc3ZnID0gZmluZFBhcmVudEJ5VGFnTmFtZSh0aGlzLl9ub2RlLCAnc3ZnJyk7IC8vIFRPRE8gc2hvdWxkIGJlIHRoZSBuYW1lc3BhY2UgYm91bmRhcnkgLSBjb3VsZCBiZSBTVkcgaW5zaWRlIFNWRwogICAgICAgICAgICAJCQkJY29udGFpbmVyID0gZmluZFRyYW5zZm9ybVBhcmVudChzdmcpOwoKICAgICAgICAgICAgCQkJCWNsb25lID0gc3ZnLmNsb25lTm9kZShmYWxzZSk7CiAgICAgICAgICAgIAkJCQljbG9uZS5hcHBlbmRDaGlsZCh0aGlzLl9jbG9uZSk7IC8vIFRPRE8gd2hhdCBhYm91dCB0cmFuc2Zvcm1zPwogICAgICAgICAgICAJCQl9IGVsc2UgewogICAgICAgICAgICAJCQkJCWNvbnRhaW5lciA9IGZpbmRUcmFuc2Zvcm1QYXJlbnQodGhpcy5fbm9kZSk7CiAgICAgICAgICAgIAkJCQkJY2xvbmUgPSB0aGlzLl9jbG9uZTsKICAgICAgICAgICAgCQkJCX0KCiAgICAgICAgICAgIAkJCXZhciBjb250YWluZXJTdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGNvbnRhaW5lcik7CiAgICAgICAgICAgIAkJCXZhciBjb250YWluZXJCY3IgPSBnZXRCb3VuZGluZ0NsaWVudFJlY3QoY29udGFpbmVyLCBpbnZlcnQoZ2V0Q3VtdWxhdGl2ZVRyYW5zZm9ybU1hdHJpeChjb250YWluZXIucGFyZW50Tm9kZSkpKTsKCiAgICAgICAgICAgIAkJCWNsb25lLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJzsKICAgICAgICAgICAgCQkJY2xvbmUuc3R5bGVbVFJBTlNGT1JNX09SSUdJTl0gPSAnMCAwJzsKICAgICAgICAgICAgCQkJY2xvbmUuc3R5bGUudG9wID0gYmNyLnRvcCAtIHBhcnNlSW50KHRoaXMuc3R5bGUubWFyZ2luVG9wLCAxMCkgLSAoY29udGFpbmVyQmNyLnRvcCAtIHBhcnNlSW50KGNvbnRhaW5lclN0eWxlLm1hcmdpblRvcCwgMTApKSArICdweCc7CiAgICAgICAgICAgIAkJCWNsb25lLnN0eWxlLmxlZnQgPSBiY3IubGVmdCAtIHBhcnNlSW50KHRoaXMuc3R5bGUubWFyZ2luTGVmdCwgMTApIC0gKGNvbnRhaW5lckJjci5sZWZ0IC0gcGFyc2VJbnQoY29udGFpbmVyU3R5bGUubWFyZ2luTGVmdCwgMTApKSArICdweCc7CgogICAgICAgICAgICAJCQljb250YWluZXIuYXBwZW5kQ2hpbGQoY2xvbmUpOwogICAgICAgICAgICAJCX0KICAgICAgICAgICAgCX0sIHsKICAgICAgICAgICAgCQlrZXk6ICdkZXRhY2gnLAogICAgICAgICAgICAJCXZhbHVlOiBmdW5jdGlvbiBkZXRhY2goKSB7CiAgICAgICAgICAgIAkJCXRoaXMuX2Nsb25lLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5fY2xvbmUpOwogICAgICAgICAgICAJCX0KICAgICAgICAgICAgCX0sIHsKICAgICAgICAgICAgCQlrZXk6ICdnZXRaSW5kZXgnLAogICAgICAgICAgICAJCXZhbHVlOiBmdW5jdGlvbiBnZXRaSW5kZXgoKSB7CiAgICAgICAgICAgIAkJCXJldHVybiBwYXJzZUZsb2F0KHRoaXMuX2Nsb25lLnN0eWxlLnpJbmRleCkgfHwgMDsKICAgICAgICAgICAgCQl9CiAgICAgICAgICAgIAl9LCB7CiAgICAgICAgICAgIAkJa2V5OiAnc2V0T3BhY2l0eScsCiAgICAgICAgICAgIAkJdmFsdWU6IGZ1bmN0aW9uIHNldE9wYWNpdHkob3BhY2l0eSkgewogICAgICAgICAgICAJCQl0aGlzLl9jbG9uZS5zdHlsZS5vcGFjaXR5ID0gb3BhY2l0eTsKICAgICAgICAgICAgCQl9CiAgICAgICAgICAgIAl9LCB7CiAgICAgICAgICAgIAkJa2V5OiAnc2V0VHJhbnNmb3JtJywKICAgICAgICAgICAgCQl2YWx1ZTogZnVuY3Rpb24gc2V0VHJhbnNmb3JtKHRyYW5zZm9ybSkgewogICAgICAgICAgICAJCQl0aGlzLl9jbG9uZS5zdHlsZS50cmFuc2Zvcm0gPSB0aGlzLl9jbG9uZS5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSB0aGlzLl9jbG9uZS5zdHlsZS5tc1RyYW5zZm9ybSA9IHRyYW5zZm9ybTsKICAgICAgICAgICAgCQl9CiAgICAgICAgICAgIAl9LCB7CiAgICAgICAgICAgIAkJa2V5OiAnc2V0QmFja2dyb3VuZENvbG9yJywKICAgICAgICAgICAgCQl2YWx1ZTogZnVuY3Rpb24gc2V0QmFja2dyb3VuZENvbG9yKGNvbG9yKSB7CiAgICAgICAgICAgIAkJCXRoaXMuX2Nsb25lLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yOwogICAgICAgICAgICAJCX0KICAgICAgICAgICAgCX0sIHsKICAgICAgICAgICAgCQlrZXk6ICdzZXRCb3JkZXJSYWRpdXMnLAogICAgICAgICAgICAJCXZhbHVlOiBmdW5jdGlvbiBzZXRCb3JkZXJSYWRpdXMoYm9yZGVyUmFkaXVzKSB7CiAgICAgICAgICAgIAkJCXRoaXMuX2Nsb25lLnN0eWxlLmJvcmRlclJhZGl1cyA9IGJvcmRlclJhZGl1czsKICAgICAgICAgICAgCQl9CiAgICAgICAgICAgIAl9LCB7CiAgICAgICAgICAgIAkJa2V5OiAnc2V0WkluZGV4JywKICAgICAgICAgICAgCQl2YWx1ZTogZnVuY3Rpb24gc2V0WkluZGV4KGluZGV4KSB7CiAgICAgICAgICAgIAkJCXRoaXMuX2Nsb25lLnN0eWxlLnpJbmRleCA9IGluZGV4OwogICAgICAgICAgICAJCX0KICAgICAgICAgICAgCX0sIHsKICAgICAgICAgICAgCQlrZXk6ICdhbmltYXRlV2l0aEtleWZyYW1lcycsCiAgICAgICAgICAgIAkJdmFsdWU6IGZ1bmN0aW9uIGFuaW1hdGVXaXRoS2V5ZnJhbWVzKGlkLCBkdXJhdGlvbiwgY2FsbGJhY2spIHsKICAgICAgICAgICAgCQkJdGhpcy5fY2xvbmUuc3R5bGVbQU5JTUFUSU9OX0RJUkVDVElPTl0gPSAnYWx0ZXJuYXRlJzsKICAgICAgICAgICAgCQkJdGhpcy5fY2xvbmUuc3R5bGVbQU5JTUFUSU9OX0RVUkFUSU9OXSA9IGR1cmF0aW9uIC8gMTAwMCArICdzJzsKICAgICAgICAgICAgCQkJdGhpcy5fY2xvbmUuc3R5bGVbQU5JTUFUSU9OX0lURVJBVElPTl9DT1VOVF0gPSAxOwogICAgICAgICAgICAJCQl0aGlzLl9jbG9uZS5zdHlsZVtBTklNQVRJT05fTkFNRV0gPSBpZDsKICAgICAgICAgICAgCQkJdGhpcy5fY2xvbmUuc3R5bGVbQU5JTUFUSU9OX1RJTUlOR19GVU5DVElPTl0gPSAnbGluZWFyJzsKICAgICAgICAgICAgCQl9CiAgICAgICAgICAgIAl9LCB7CiAgICAgICAgICAgIAkJa2V5OiAnZnJlZXplJywKICAgICAgICAgICAgCQl2YWx1ZTogZnVuY3Rpb24gZnJlZXplKCkgewogICAgICAgICAgICAJCQl2YXIgY29tcHV0ZWRTdHlsZSA9IGdldENvbXB1dGVkU3R5bGUodGhpcy5fY2xvbmUpOwoKICAgICAgICAgICAgCQkJdGhpcy5zZXRPcGFjaXR5KGNvbXB1dGVkU3R5bGUub3BhY2l0eSk7CiAgICAgICAgICAgIAkJCXRoaXMuc2V0VHJhbnNmb3JtKGNvbXB1dGVkU3R5bGUudHJhbnNmb3JtKTsKICAgICAgICAgICAgCQkJdGhpcy5zZXRCYWNrZ3JvdW5kQ29sb3IoY29tcHV0ZWRTdHlsZS5iYWNrZ3JvdW5kQ29sb3IpOwogICAgICAgICAgICAJCQl0aGlzLnNldEJvcmRlclJhZGl1cyhjb21wdXRlZFN0eWxlLmJvcmRlclJhZGl1cyk7CgogICAgICAgICAgICAJCQl0aGlzLl9jbG9uZS5zdHlsZVtBTklNQVRJT05dID0gJ25vbmUnOwogICAgICAgICAgICAJCX0KICAgICAgICAgICAgCX1dKTsKICAgICAgICAgICAgCXJldHVybiBIdG1sV3JhcHBlcjsKICAgICAgICAgICAgfSgpOwoKICAgICAgICAgICAgZnVuY3Rpb24gd3JhcE5vZGUobm9kZSwgb3B0aW9ucykgewogICAgICAgICAgICAJcmV0dXJuIG5ldyBIdG1sV3JhcHBlcihub2RlLCBvcHRpb25zKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gZ2V0T3BhY2l0eUludGVycG9sYXRvcihhLCBiKSB7CiAgICAgICAgICAgIAl2YXIgb3BhY2l0eSA9IHt9OwoKICAgICAgICAgICAgCXJldHVybiBmdW5jdGlvbiBpbnRlcnBvbGF0b3IodCkgewogICAgICAgICAgICAJCXZhciB0YXJnZXRPcGFjaXR5ID0gKGIgLSBhKSAqIHQgKyBhOwoKICAgICAgICAgICAgCQkvLyBCYXNlZCBvbiB0aGUgYmxlbmRpbmcgZm9ybXVsYSBoZXJlLiAoaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9BbHBoYV9jb21wb3NpdGluZyNBbHBoYV9ibGVuZGluZykKICAgICAgICAgICAgCQkvLyBUaGlzIGlzIGEgcXVhZHJhdGljIGJsZW5kaW5nIGZ1bmN0aW9uIHRoYXQgbWFrZXMgdGhlIHRvcCBsYXllciBhbmQgYm90dG9tIGxheWVyIGJsZW5kIGxpbmVhcmx5LgogICAgICAgICAgICAJCS8vIEhvd2V2ZXIgdGhlcmUgaXMgYW4gYXN5bXB0b3RlIGF0IHRhcmdldD0xIHNvIHRoYXQgbmVlZHMgdG8gYmUgaGFuZGxlZCB3aXRoIGFuIGlmIGVsc2Ugc3RhdGVtZW50LgogICAgICAgICAgICAJCWlmICh0YXJnZXRPcGFjaXR5ID09PSAxKSB7CiAgICAgICAgICAgIAkJCW9wYWNpdHkuZnJvbSA9IDE7CiAgICAgICAgICAgIAkJCW9wYWNpdHkudG8gPSB0OwogICAgICAgICAgICAJCX0gZWxzZSB7CiAgICAgICAgICAgIAkJCW9wYWNpdHkuZnJvbSA9IHRhcmdldE9wYWNpdHkgLSB0ICogdCAqIHRhcmdldE9wYWNpdHk7CiAgICAgICAgICAgIAkJCW9wYWNpdHkudG8gPSAodGFyZ2V0T3BhY2l0eSAtIG9wYWNpdHkuZnJvbSkgLyAoMSAtIG9wYWNpdHkuZnJvbSk7CiAgICAgICAgICAgIAkJfQoKICAgICAgICAgICAgCQlyZXR1cm4gb3BhY2l0eTsKICAgICAgICAgICAgCX07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFJnYmFJbnRlcnBvbGF0b3IoYSwgYikgewogICAgICAgICAgICAJaWYgKGEuYWxwaGEgPT09IDEgJiYgYi5hbHBoYSA9PT0gMSkgewogICAgICAgICAgICAJCS8vIG5vIG5lZWQgdG8gYW5pbWF0ZSBhbnl0aGluZwogICAgICAgICAgICAJCXJldHVybiBudWxsOwogICAgICAgICAgICAJfQoKICAgICAgICAgICAgCXZhciByZ2JhID0ge307CiAgICAgICAgICAgIAl2YXIgb3BhY2l0eUF0ID0gZ2V0T3BhY2l0eUludGVycG9sYXRvcihhLmFscGhhLCBiLmFscGhhKTsKCiAgICAgICAgICAgIAlyZXR1cm4gZnVuY3Rpb24gaW50ZXJwb2xhdG9yKHQpIHsKICAgICAgICAgICAgCQl2YXIgb3BhY2l0eSA9IG9wYWNpdHlBdCh0KTsKCiAgICAgICAgICAgIAkJcmdiYS5mcm9tID0gJ3JnYmEoJyArIGEuciArICcsJyArIGEuZyArICcsJyArIGEuYiArICcsJyArIG9wYWNpdHkuZnJvbSArICcpJzsKICAgICAgICAgICAgCQlyZ2JhLnRvID0gJ3JnYmEoJyArIGIuciArICcsJyArIGIuZyArICcsJyArIGIuYiArICcsJyArIG9wYWNpdHkudG8gKyAnKSc7CgogICAgICAgICAgICAJCXJldHVybiByZ2JhOwogICAgICAgICAgICAJfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQm9yZGVyIHJhZGl1cyBpcyBnaXZlbiBhcyBhIHN0cmluZyBpbiB0aGUgZm9sbG93aW5nIGZvcm0KICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gICAgIHRsLnggdHIueCBici54IGJsLnggLyB0bC55IHRyLnkgYnIueSBibC55CiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIC4uLndoZXJlIHQsIHIsIGIgYW5kIGwgYXJlIHRvcCwgcmlnaHQsIGJvdHRvbSwgbGVmdCwgYW5kCiAgICAgICAgICAgIC8vIHggYW5kIHkgYXJlIHNlbGYtZXhwbGFuYXRvcnkuIEVhY2ggdmFsdWUgaXMgZm9sbG93ZWQgYnkgJ3B4JwoKICAgICAgICAgICAgLy8gVE9ETyBpdCBtdXN0IGJlIHBvc3NpYmxlIHRvIGRvIHRoaXMgbW9yZSBzaW1wbHkuIE1heWJlIGhhdmUKICAgICAgICAgICAgLy8gYSBmbGF0IGFycmF5IGZyb20gdGhlIHN0YXJ0PwoKICAgICAgICAgICAgZnVuY3Rpb24gZ2V0Qm9yZGVyUmFkaXVzSW50ZXJwb2xhdG9yKGEsIGIpIHsKICAgICAgICAgICAgCS8vIFRPRE8gZmFzdCBwYXRoIC0gbm8gdHJhbnNpdGlvbiBuZWVkZWQKCiAgICAgICAgICAgIAl2YXIgYVdpZHRoID0gYS53aWR0aDsKICAgICAgICAgICAgCXZhciBhSGVpZ2h0ID0gYS5oZWlnaHQ7CgogICAgICAgICAgICAJdmFyIGJXaWR0aCA9IGIud2lkdGg7CiAgICAgICAgICAgIAl2YXIgYkhlaWdodCA9IGIuaGVpZ2h0OwoKICAgICAgICAgICAgCWEgPSBhLmJvcmRlclJhZGl1czsKICAgICAgICAgICAgCWIgPSBiLmJvcmRlclJhZGl1czsKCiAgICAgICAgICAgIAl2YXIgYV94X3QwID0gW2EudGwueCwgYS50ci54LCBhLmJyLngsIGEuYmwueF07CiAgICAgICAgICAgIAl2YXIgYV95X3QwID0gW2EudGwueSwgYS50ci55LCBhLmJyLnksIGEuYmwueV07CgogICAgICAgICAgICAJdmFyIGJfeF90MSA9IFtiLnRsLngsIGIudHIueCwgYi5ici54LCBiLmJsLnhdOwogICAgICAgICAgICAJdmFyIGJfeV90MSA9IFtiLnRsLnksIGIudHIueSwgYi5ici55LCBiLmJsLnldOwoKICAgICAgICAgICAgCXZhciBhX3hfdDEgPSBiX3hfdDEubWFwKGZ1bmN0aW9uICh4KSB7CiAgICAgICAgICAgIAkJcmV0dXJuIHggKiBhV2lkdGggLyBiV2lkdGg7CiAgICAgICAgICAgIAl9KTsKICAgICAgICAgICAgCXZhciBhX3lfdDEgPSBiX3lfdDEubWFwKGZ1bmN0aW9uICh5KSB7CiAgICAgICAgICAgIAkJcmV0dXJuIHkgKiBhSGVpZ2h0IC8gYkhlaWdodDsKICAgICAgICAgICAgCX0pOwoKICAgICAgICAgICAgCXZhciBiX3hfdDAgPSBhX3hfdDAubWFwKGZ1bmN0aW9uICh4KSB7CiAgICAgICAgICAgIAkJcmV0dXJuIHggKiBiV2lkdGggLyBhV2lkdGg7CiAgICAgICAgICAgIAl9KTsKICAgICAgICAgICAgCXZhciBiX3lfdDAgPSBhX3lfdDAubWFwKGZ1bmN0aW9uICh5KSB7CiAgICAgICAgICAgIAkJcmV0dXJuIHkgKiBiSGVpZ2h0IC8gYUhlaWdodDsKICAgICAgICAgICAgCX0pOwoKICAgICAgICAgICAgCXZhciBheCA9IGludGVycG9sYXRlQXJyYXkoYV94X3QwLCBhX3hfdDEpOwogICAgICAgICAgICAJdmFyIGF5ID0gaW50ZXJwb2xhdGVBcnJheShhX3lfdDAsIGFfeV90MSk7CgogICAgICAgICAgICAJdmFyIGJ4ID0gaW50ZXJwb2xhdGVBcnJheShiX3hfdDAsIGJfeF90MSk7CiAgICAgICAgICAgIAl2YXIgYnkgPSBpbnRlcnBvbGF0ZUFycmF5KGJfeV90MCwgYl95X3QxKTsKCiAgICAgICAgICAgIAl2YXIgYm9yZGVyUmFkaXVzID0ge307CgogICAgICAgICAgICAJcmV0dXJuIGZ1bmN0aW9uIGludGVycG9sYXRvcih0KSB7CiAgICAgICAgICAgIAkJdmFyIHggPSBheCh0KTsKICAgICAgICAgICAgCQl2YXIgeSA9IGF5KHQpOwoKICAgICAgICAgICAgCQlib3JkZXJSYWRpdXMuZnJvbSA9IHguam9pbigncHggJykgKyAncHggLyAnICsgeS5qb2luKCdweCAnKSArICdweCc7CgogICAgICAgICAgICAJCXggPSBieCh0KTsKICAgICAgICAgICAgCQl5ID0gYnkodCk7CgogICAgICAgICAgICAJCWJvcmRlclJhZGl1cy50byA9IHguam9pbigncHggJykgKyAncHggLyAnICsgeS5qb2luKCdweCAnKSArICdweCc7CgogICAgICAgICAgICAJCXJldHVybiBib3JkZXJSYWRpdXM7CiAgICAgICAgICAgIAl9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBpbnRlcnBvbGF0ZUFycmF5KGEsIGIpIHsKICAgICAgICAgICAgCXZhciBsZW4gPSBhLmxlbmd0aDsKICAgICAgICAgICAgCXZhciBhcnJheSA9IG5ldyBBcnJheShsZW4pOwoKICAgICAgICAgICAgCXJldHVybiBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAJCXZhciBpID0gbGVuOwogICAgICAgICAgICAJCXdoaWxlIChpLS0pIHsKICAgICAgICAgICAgCQkJYXJyYXlbaV0gPSBhW2ldICsgdCAqIChiW2ldIC0gYVtpXSk7CiAgICAgICAgICAgIAkJfQoKICAgICAgICAgICAgCQlyZXR1cm4gYXJyYXk7CiAgICAgICAgICAgIAl9OwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBUT0RPIHJlZmFjdG9yIHRoaXMsIEkgaGF2ZSBubyBpZGVhIGhvdyBpdCB3b3JrcwogICAgICAgICAgICBmdW5jdGlvbiBnZXRUcmFuc2Zvcm1JbnRlcnBvbGF0b3IoYSwgYikgewogICAgICAgICAgICAJdmFyIGFfc3RhcnQgPSBhLnRyYW5zZm9ybTsKICAgICAgICAgICAgCXZhciBhX3RvX2IgPSBbYi53aWR0aCAvIGEud2lkdGgsIDAsIDAsIGIuaGVpZ2h0IC8gYS5oZWlnaHQsIGIubGVmdCAtIGEubGVmdCwgYi50b3AgLSBhLnRvcF07CgogICAgICAgICAgICAJdmFyIGFfZW5kID0gbXVsdGlwbHkobXVsdGlwbHkoYS5pbnZlcnRlZFBhcmVudENUTSwgYV90b19iKSwgYi5jdG0pOwogICAgICAgICAgICAJLy9jb25zdCBhX2VuZCA9IG11bHRpcGx5KCBiLmN0bSwgbXVsdGlwbHkoIGEuaW52ZXJ0ZWRQYXJlbnRDVE0sIGFfdG9fYiApICk7CiAgICAgICAgICAgIAkvL2NvbnN0IGFfZW5kID0gbXVsdGlwbHkoIGIuY3RtLCBtdWx0aXBseSggYV90b19iLCBhLmludmVydGVkUGFyZW50Q1RNICkgKTsKCiAgICAgICAgICAgIAl2YXIgdHJhbnNmb3JtID0gW107CgogICAgICAgICAgICAJcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIAkJdHJhbnNmb3JtID0gYV9zdGFydC5tYXAoZnVuY3Rpb24gKGZyb20sIGkpIHsKICAgICAgICAgICAgCQkJdmFyIHRvID0gYV9lbmRbaV07CgogICAgICAgICAgICAJCQlyZXR1cm4gZnJvbSArIHQgKiAodG8gLSBmcm9tKTsKICAgICAgICAgICAgCQl9KTsKCiAgICAgICAgICAgIAkJcmV0dXJuICdtYXRyaXgoJyArIHRyYW5zZm9ybS5qb2luKCcsJykgKyAnKSc7CiAgICAgICAgICAgIAl9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBsaW5lYXIocG9zKSB7CiAgICAgICAgICAgIAlyZXR1cm4gcG9zOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBlYXNlSW4ocG9zKSB7CiAgICAgICAgICAgIAlyZXR1cm4gTWF0aC5wb3cocG9zLCAzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gZWFzZU91dChwb3MpIHsKICAgICAgICAgICAgCXJldHVybiBNYXRoLnBvdyhwb3MgLSAxLCAzKSArIDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGVhc2VJbk91dChwb3MpIHsKICAgICAgICAgICAgCWlmICgocG9zIC89IDAuNSkgPCAxKSB7CiAgICAgICAgICAgIAkJcmV0dXJuIDAuNSAqIE1hdGgucG93KHBvcywgMyk7CiAgICAgICAgICAgIAl9CgogICAgICAgICAgICAJcmV0dXJuIDAuNSAqIChNYXRoLnBvdyhwb3MgLSAyLCAzKSArIDIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgckFGID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCB3aW5kb3cud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IGZ1bmN0aW9uIChmbikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2V0VGltZW91dChmbiwgMTYpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgZnVuY3Rpb24gdHJhbnNmb3JtZXIoZnJvbSwgdG8sIG9wdGlvbnMpIHsKICAgICAgICAgICAgCXZhciBkdXJhdGlvbiA9IG9wdGlvbnMuZHVyYXRpb24gfHwgNDAwOwogICAgICAgICAgICAJdmFyIGVhc2luZyA9IG9wdGlvbnMuZWFzaW5nIHx8IGxpbmVhcjsKCiAgICAgICAgICAgIAl2YXIgdXNlVGltZXIgPSAha2V5ZnJhbWVzU3VwcG9ydGVkIHx8ICEhb3B0aW9ucy51c2VUaW1lcjsKCiAgICAgICAgICAgIAl2YXIgb3BhY2l0eUF0ID0gZ2V0T3BhY2l0eUludGVycG9sYXRvcihmcm9tLm9wYWNpdHksIHRvLm9wYWNpdHkpOwogICAgICAgICAgICAJdmFyIGJhY2tncm91bmRDb2xvckF0ID0gZ2V0UmdiYUludGVycG9sYXRvcihmcm9tLnJnYmEsIHRvLnJnYmEpOwogICAgICAgICAgICAJdmFyIGJvcmRlclJhZGl1c0F0ID0gZ2V0Qm9yZGVyUmFkaXVzSW50ZXJwb2xhdG9yKGZyb20sIHRvKTsKICAgICAgICAgICAgCXZhciB0cmFuc2Zvcm1Gcm9tQXQgPSBnZXRUcmFuc2Zvcm1JbnRlcnBvbGF0b3IoZnJvbSwgdG8pOwogICAgICAgICAgICAJdmFyIHRyYW5zZm9ybVRvQXQgPSBnZXRUcmFuc2Zvcm1JbnRlcnBvbGF0b3IodG8sIGZyb20pOwoKICAgICAgICAgICAgCXZhciBydW5uaW5nID0gdW5kZWZpbmVkOwogICAgICAgICAgICAJdmFyIGRpc3Bvc2VDc3MgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIAl2YXIgdG9ybmRvd24gPSB1bmRlZmluZWQ7CgogICAgICAgICAgICAJdmFyIHJlbWFpbmluZyA9IGR1cmF0aW9uOwogICAgICAgICAgICAJdmFyIGVuZFRpbWUgPSB1bmRlZmluZWQ7CgogICAgICAgICAgICAJZnVuY3Rpb24gdGljaygpIHsKICAgICAgICAgICAgCQlpZiAoIXJ1bm5pbmcpIHJldHVybjsKCiAgICAgICAgICAgIAkJdmFyIHRpbWVOb3cgPSBEYXRlLm5vdygpOwogICAgICAgICAgICAJCXJlbWFpbmluZyA9IGVuZFRpbWUgLSB0aW1lTm93OwoKICAgICAgICAgICAgCQlpZiAocmVtYWluaW5nIDwgMCkgewogICAgICAgICAgICAJCQl0cmFuc2Zvcm1lci50ZWFyZG93bigpOwogICAgICAgICAgICAJCQlpZiAob3B0aW9ucy5kb25lKSBvcHRpb25zLmRvbmUoKTsKCiAgICAgICAgICAgIAkJCXJldHVybjsKICAgICAgICAgICAgCQl9CgogICAgICAgICAgICAJCXZhciB0ID0gZWFzaW5nKDEgLSByZW1haW5pbmcgLyBkdXJhdGlvbik7CiAgICAgICAgICAgIAkJdHJhbnNmb3JtZXIuZ290byh0KTsKCiAgICAgICAgICAgIAkJckFGKHRpY2spOwogICAgICAgICAgICAJfQoKICAgICAgICAgICAgCXZhciB0cmFuc2Zvcm1lciA9IHsKICAgICAgICAgICAgCQl0ZWFyZG93bjogZnVuY3Rpb24gdGVhcmRvd24oKSB7CiAgICAgICAgICAgIAkJCWlmICh0b3JuZG93bikgcmV0dXJuIHRyYW5zZm9ybWVyOwoKICAgICAgICAgICAgCQkJcnVubmluZyA9IGZhbHNlOwogICAgICAgICAgICAJCQl0b3JuZG93biA9IHRydWU7CgogICAgICAgICAgICAJCQlmcm9tLmRldGFjaCgpOwogICAgICAgICAgICAJCQl0by5kZXRhY2goKTsKCiAgICAgICAgICAgIAkJCWZyb20gPSBudWxsOwogICAgICAgICAgICAJCQl0byA9IG51bGw7CgogICAgICAgICAgICAJCQlyZXR1cm4gdHJhbnNmb3JtZXI7CiAgICAgICAgICAgIAkJfSwKICAgICAgICAgICAgCQlnb3RvOiBmdW5jdGlvbiBnb3RvKHBvcykgewogICAgICAgICAgICAJCQl0cmFuc2Zvcm1lci5wYXVzZSgpOwoKICAgICAgICAgICAgCQkJdmFyIHQgPSBlYXNpbmcocG9zKTsKCiAgICAgICAgICAgIAkJCS8vIG9wYWNpdHkKICAgICAgICAgICAgCQkJdmFyIG9wYWNpdHkgPSBvcGFjaXR5QXQodCk7CiAgICAgICAgICAgIAkJCWZyb20uc2V0T3BhY2l0eShvcGFjaXR5LmZyb20pOwogICAgICAgICAgICAJCQl0by5zZXRPcGFjaXR5KG9wYWNpdHkudG8pOwoKICAgICAgICAgICAgCQkJLy8gYmFja2dyb3VuZCBjb2xvcgogICAgICAgICAgICAJCQlpZiAoYmFja2dyb3VuZENvbG9yQXQpIHsKICAgICAgICAgICAgCQkJCXZhciBiYWNrZ3JvdW5kQ29sb3IgPSBiYWNrZ3JvdW5kQ29sb3JBdCh0KTsKICAgICAgICAgICAgCQkJCWZyb20uc2V0QmFja2dyb3VuZENvbG9yKGJhY2tncm91bmRDb2xvci5mcm9tKTsKICAgICAgICAgICAgCQkJCXRvLnNldEJhY2tncm91bmRDb2xvcihiYWNrZ3JvdW5kQ29sb3IudG8pOwogICAgICAgICAgICAJCQl9CgogICAgICAgICAgICAJCQkvLyBib3JkZXIgcmFkaXVzCiAgICAgICAgICAgIAkJCXZhciBib3JkZXJSYWRpdXMgPSBib3JkZXJSYWRpdXNBdCh0KTsKICAgICAgICAgICAgCQkJZnJvbS5zZXRCb3JkZXJSYWRpdXMoYm9yZGVyUmFkaXVzLmZyb20pOwogICAgICAgICAgICAJCQl0by5zZXRCb3JkZXJSYWRpdXMoYm9yZGVyUmFkaXVzLnRvKTsKCiAgICAgICAgICAgIAkJCS8vIHRyYW5zZm9ybQogICAgICAgICAgICAJCQl2YXIgdHJhbnNmb3JtRnJvbSA9IHRyYW5zZm9ybUZyb21BdCh0KTsKICAgICAgICAgICAgCQkJdmFyIHRyYW5zZm9ybVRvID0gdHJhbnNmb3JtVG9BdCgxIC0gdCk7CiAgICAgICAgICAgIAkJCWZyb20uc2V0VHJhbnNmb3JtKHRyYW5zZm9ybUZyb20pOwogICAgICAgICAgICAJCQl0by5zZXRUcmFuc2Zvcm0odHJhbnNmb3JtVG8pOwoKICAgICAgICAgICAgCQkJcmV0dXJuIHRyYW5zZm9ybWVyOwogICAgICAgICAgICAJCX0sCiAgICAgICAgICAgIAkJcGF1c2U6IGZ1bmN0aW9uIHBhdXNlKCkgewogICAgICAgICAgICAJCQlpZiAoIXJ1bm5pbmcpIHJldHVybiB0cmFuc2Zvcm1lcjsKICAgICAgICAgICAgCQkJcnVubmluZyA9IGZhbHNlOwoKICAgICAgICAgICAgCQkJaWYgKCF1c2VUaW1lcikgewogICAgICAgICAgICAJCQkJLy8gVE9ETyBkZXJpdmUgY3VycmVudCBwb3NpdGlvbiBzb21laG93LCB1c2UgdGhhdCByYXRoZXIgdGhhbgogICAgICAgICAgICAJCQkJLy8gY3VycmVudCBjb21wdXRlZCBzdHlsZSAoZnJvbSBhbmQgdG8gZ2V0IG91dCBvZiBzeW5jIGluCiAgICAgICAgICAgIAkJCQkvLyBzb21lIGJyb3dzZXJzPykKICAgICAgICAgICAgCQkJCXJlbWFpbmluZyA9IGVuZFRpbWUgLSBEYXRlLm5vdygpOwoKICAgICAgICAgICAgCQkJCWZyb20uZnJlZXplKCk7CiAgICAgICAgICAgIAkJCQl0by5mcmVlemUoKTsKICAgICAgICAgICAgCQkJCWRpc3Bvc2VDc3MoKTsKICAgICAgICAgICAgCQkJfQoKICAgICAgICAgICAgCQkJcmV0dXJuIHRyYW5zZm9ybWVyOwogICAgICAgICAgICAJCX0sCiAgICAgICAgICAgIAkJcGxheTogZnVuY3Rpb24gcGxheSgpIHsKICAgICAgICAgICAgCQkJaWYgKHJ1bm5pbmcpIHJldHVybiB0cmFuc2Zvcm1lcjsKICAgICAgICAgICAgCQkJcnVubmluZyA9IHRydWU7CgogICAgICAgICAgICAJCQllbmRUaW1lID0gRGF0ZS5ub3coKSArIHJlbWFpbmluZzsKCiAgICAgICAgICAgIAkJCWlmICh1c2VUaW1lcikgewogICAgICAgICAgICAJCQkJckFGKHRpY2spOwogICAgICAgICAgICAJCQl9IGVsc2UgewogICAgICAgICAgICAJCQkJdmFyIF9nZXRLZXlmcmFtZXMgPSBnZXRLZXlmcmFtZXMoZnJvbSwgdG8sIG9wdGlvbnMuZWFzaW5nIHx8IGxpbmVhciwgcmVtYWluaW5nLCBkdXJhdGlvbik7CgogICAgICAgICAgICAJCQkJdmFyIGZyb21LZXlmcmFtZXMgPSBfZ2V0S2V5ZnJhbWVzLmZyb21LZXlmcmFtZXM7CiAgICAgICAgICAgIAkJCQl2YXIgdG9LZXlmcmFtZXMgPSBfZ2V0S2V5ZnJhbWVzLnRvS2V5ZnJhbWVzOwoKICAgICAgICAgICAgCQkJCXZhciBmcm9tSWQgPSBnZW5lcmF0ZUlkKCk7CiAgICAgICAgICAgIAkJCQl2YXIgdG9JZCA9IGdlbmVyYXRlSWQoKTsKCiAgICAgICAgICAgIAkJCQl2YXIgY3NzID0gJ1xuXHRcdFx0XHRcdCcgKyBLRVlGUkFNRVMgKyAnICcgKyBmcm9tSWQgKyAnIHsgJyArIGZyb21LZXlmcmFtZXMgKyAnIH1cblx0XHRcdFx0XHQnICsgS0VZRlJBTUVTICsgJyAnICsgdG9JZCArICcgICB7ICcgKyB0b0tleWZyYW1lcyArICcgfSc7CgogICAgICAgICAgICAJCQkJZGlzcG9zZUNzcyA9IGFkZENzcyhjc3MpOwoKICAgICAgICAgICAgCQkJCWZyb20uYW5pbWF0ZVdpdGhLZXlmcmFtZXMoZnJvbUlkLCByZW1haW5pbmcpOwogICAgICAgICAgICAJCQkJdG8uYW5pbWF0ZVdpdGhLZXlmcmFtZXModG9JZCwgcmVtYWluaW5nKTsKICAgICAgICAgICAgCQkJfQoKICAgICAgICAgICAgCQkJcmV0dXJuIHRyYW5zZm9ybWVyOwogICAgICAgICAgICAJCX0KICAgICAgICAgICAgCX07CgogICAgICAgICAgICAJLy8gaGFuZGxlIGFuaW1hdGlvbiBlbmQKICAgICAgICAgICAgCWlmICghdXNlVGltZXIpIHsKICAgICAgICAgICAgCQkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAJCQl2YXIgYW5pbWF0aW5nID0gMjsKCiAgICAgICAgICAgIAkJCXZhciBkb25lID0gZnVuY3Rpb24gZG9uZSgpIHsKICAgICAgICAgICAgCQkJCWlmICghIC0tYW5pbWF0aW5nKSB7CiAgICAgICAgICAgIAkJCQkJdHJhbnNmb3JtZXIudGVhcmRvd24oKTsKCiAgICAgICAgICAgIAkJCQkJaWYgKG9wdGlvbnMuZG9uZSkgb3B0aW9ucy5kb25lKCk7CgogICAgICAgICAgICAJCQkJCWRpc3Bvc2VDc3MoKTsKICAgICAgICAgICAgCQkJCX0KICAgICAgICAgICAgCQkJfTsKCiAgICAgICAgICAgIAkJCWZyb20uX2Nsb25lLmFkZEV2ZW50TGlzdGVuZXIoQU5JTUFUSU9OX0VORCwgZG9uZSk7CiAgICAgICAgICAgIAkJCXRvLl9jbG9uZS5hZGRFdmVudExpc3RlbmVyKEFOSU1BVElPTl9FTkQsIGRvbmUpOwogICAgICAgICAgICAJCX0pKCk7CiAgICAgICAgICAgIAl9CgogICAgICAgICAgICAJdHJhbnNmb3JtZXIucGxheSgpOwoKICAgICAgICAgICAgCXJldHVybiB0cmFuc2Zvcm1lcjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gZ2VuZXJhdGVJZCgpIHsKICAgICAgICAgICAgCXJldHVybiAncmFtamV0JyArIH4gfihNYXRoLnJhbmRvbSgpICogMTAwMDAwMCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGFkZENzcyhjc3MpIHsKICAgICAgICAgICAgCXZhciBzdHlsZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpOwogICAgICAgICAgICAJc3R5bGVFbGVtZW50LnR5cGUgPSAndGV4dC9jc3MnOwoKICAgICAgICAgICAgCXZhciBoZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXTsKCiAgICAgICAgICAgIAkvLyBJbnRlcm5ldCBFeHBsb2RlciB3b24ndCBsZXQgeW91IHVzZSBzdHlsZVNoZWV0LmlubmVySFRNTCAtIHdlIGhhdmUgdG8KICAgICAgICAgICAgCS8vIHVzZSBzdHlsZVNoZWV0LmNzc1RleHQgaW5zdGVhZAogICAgICAgICAgICAJdmFyIHN0eWxlU2hlZXQgPSBzdHlsZUVsZW1lbnQuc3R5bGVTaGVldDsKCiAgICAgICAgICAgIAlpZiAoc3R5bGVTaGVldCkgewogICAgICAgICAgICAJCXN0eWxlU2hlZXQuY3NzVGV4dCA9IGNzczsKICAgICAgICAgICAgCX0gZWxzZSB7CiAgICAgICAgICAgIAkJc3R5bGVFbGVtZW50LmlubmVySFRNTCA9IGNzczsKICAgICAgICAgICAgCX0KCiAgICAgICAgICAgIAloZWFkLmFwcGVuZENoaWxkKHN0eWxlRWxlbWVudCk7CgogICAgICAgICAgICAJcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgCQlyZXR1cm4gaGVhZC5yZW1vdmVDaGlsZChzdHlsZUVsZW1lbnQpOwogICAgICAgICAgICAJfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gZ2V0S2V5ZnJhbWVzKGZyb20sIHRvLCBlYXNpbmcsIHJlbWFpbmluZywgZHVyYXRpb24pIHsKICAgICAgICAgICAgCS8vIFRPRE8gd2UgYWxyZWFkeSBoYXZlIHRoZXNlIGludGVycG9sYXRvcnMuLi4KICAgICAgICAgICAgCXZhciBvcGFjaXR5QXQgPSBnZXRPcGFjaXR5SW50ZXJwb2xhdG9yKGZyb20ub3BhY2l0eSwgdG8ub3BhY2l0eSk7CiAgICAgICAgICAgIAl2YXIgYmFja2dyb3VuZENvbG9yQXQgPSBnZXRSZ2JhSW50ZXJwb2xhdG9yKGZyb20ucmdiYSwgdG8ucmdiYSk7CiAgICAgICAgICAgIAl2YXIgYm9yZGVyUmFkaXVzQXQgPSBnZXRCb3JkZXJSYWRpdXNJbnRlcnBvbGF0b3IoZnJvbSwgdG8pOwogICAgICAgICAgICAJdmFyIHRyYW5zZm9ybUZyb21BdCA9IGdldFRyYW5zZm9ybUludGVycG9sYXRvcihmcm9tLCB0byk7CiAgICAgICAgICAgIAl2YXIgdHJhbnNmb3JtVG9BdCA9IGdldFRyYW5zZm9ybUludGVycG9sYXRvcih0bywgZnJvbSk7CgogICAgICAgICAgICAJdmFyIG51bUZyYW1lcyA9IHJlbWFpbmluZyAvIDE2OwoKICAgICAgICAgICAgCXZhciBmcm9tS2V5ZnJhbWVzID0gJyc7CiAgICAgICAgICAgIAl2YXIgdG9LZXlmcmFtZXMgPSAnJzsKCiAgICAgICAgICAgIAlmdW5jdGlvbiBhZGRLZXlmcmFtZXMocGMsIHQpIHsKICAgICAgICAgICAgCQl2YXIgb3BhY2l0eSA9IG9wYWNpdHlBdCh0KTsKICAgICAgICAgICAgCQl2YXIgYmFja2dyb3VuZENvbG9yID0gYmFja2dyb3VuZENvbG9yQXQgPyBiYWNrZ3JvdW5kQ29sb3JBdCh0KSA6IG51bGw7CiAgICAgICAgICAgIAkJdmFyIGJvcmRlclJhZGl1cyA9IGJvcmRlclJhZGl1c0F0KHQpOyAvLyBUT0RPIHRoaXMgbmVlZHMgdG8gYmUgb3B0aW9uYWwsIHRvIGF2b2lkIHJlcGFpbnRzCiAgICAgICAgICAgIAkJdmFyIHRyYW5zZm9ybUZyb20gPSB0cmFuc2Zvcm1Gcm9tQXQodCk7CiAgICAgICAgICAgIAkJdmFyIHRyYW5zZm9ybVRvID0gdHJhbnNmb3JtVG9BdCgxIC0gdCk7CgogICAgICAgICAgICAJCWZyb21LZXlmcmFtZXMgKz0gJ1xuJyArIChwYyArICclIHsnKSArICgnb3BhY2l0eTogJyArIG9wYWNpdHkuZnJvbSArICc7JykgKyAoVFJBTlNGT1JNX0NTUyArICc6ICcgKyB0cmFuc2Zvcm1Gcm9tICsgJzsnKSArIChiYWNrZ3JvdW5kQ29sb3IgPyAnYmFja2dyb3VuZC1jb2xvcjogJyArIGJhY2tncm91bmRDb2xvci5mcm9tICsgJzsnIDogJycpICsgKCdib3JkZXItcmFkaXVzOiAnICsgYm9yZGVyUmFkaXVzLmZyb20gKyAnOycpICsgJ30nOwoKICAgICAgICAgICAgCQl0b0tleWZyYW1lcyArPSAnXG4nICsgKHBjICsgJyUgeycpICsgKCdvcGFjaXR5OiAnICsgb3BhY2l0eS50byArICc7JykgKyAoVFJBTlNGT1JNX0NTUyArICc6ICcgKyB0cmFuc2Zvcm1UbyArICc7JykgKyAoYmFja2dyb3VuZENvbG9yID8gJ2JhY2tncm91bmQtY29sb3I6ICcgKyBiYWNrZ3JvdW5kQ29sb3IudG8gKyAnOycgOiAnJykgKyAoJ2JvcmRlci1yYWRpdXM6ICcgKyBib3JkZXJSYWRpdXMudG8gKyAnOycpICsgJ30nOwogICAgICAgICAgICAJfQoKICAgICAgICAgICAgCXZhciBpID0gdW5kZWZpbmVkOwogICAgICAgICAgICAJdmFyIHN0YXJ0UG9zID0gMSAtIHJlbWFpbmluZyAvIGR1cmF0aW9uOwoKICAgICAgICAgICAgCWZvciAoaSA9IDA7IGkgPCBudW1GcmFtZXM7IGkgKz0gMSkgewogICAgICAgICAgICAJCXZhciByZWxQb3MgPSBpIC8gbnVtRnJhbWVzOwogICAgICAgICAgICAJCXZhciBhYnNQb3MgPSBzdGFydFBvcyArIHJlbWFpbmluZyAvIGR1cmF0aW9uICogcmVsUG9zOwoKICAgICAgICAgICAgCQl2YXIgcGMgPSAxMDAgKiByZWxQb3M7CiAgICAgICAgICAgIAkJdmFyIHQgPSBlYXNpbmcoYWJzUG9zKTsKCiAgICAgICAgICAgIAkJYWRkS2V5ZnJhbWVzKHBjLCB0KTsKICAgICAgICAgICAgCX0KCiAgICAgICAgICAgIAlhZGRLZXlmcmFtZXMoMTAwLCAxKTsKCiAgICAgICAgICAgIAlyZXR1cm4geyBmcm9tS2V5ZnJhbWVzOiBmcm9tS2V5ZnJhbWVzLCB0b0tleWZyYW1lczogdG9LZXlmcmFtZXMgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHJhbWpldCA9IHsKICAgICAgICAgICAgCXRyYW5zZm9ybTogZnVuY3Rpb24gdHJhbnNmb3JtKGZyb21Ob2RlLCB0b05vZGUpIHsKICAgICAgICAgICAgCQl2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMiB8fCBhcmd1bWVudHNbMl0gPT09IHVuZGVmaW5lZCA/IHt9IDogYXJndW1lbnRzWzJdOwoKICAgICAgICAgICAgCQlpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgCQkJb3B0aW9ucyA9IHsgZG9uZTogb3B0aW9ucyB9OwogICAgICAgICAgICAJCX0KCiAgICAgICAgICAgIAkJaWYgKCEoJ2R1cmF0aW9uJyBpbiBvcHRpb25zKSkgewogICAgICAgICAgICAJCQlvcHRpb25zLmR1cmF0aW9uID0gNDAwOwogICAgICAgICAgICAJCX0KCiAgICAgICAgICAgIAkJdmFyIGZyb20gPSB3cmFwTm9kZShmcm9tTm9kZSwgb3B0aW9ucyk7CiAgICAgICAgICAgIAkJdmFyIHRvID0gd3JhcE5vZGUodG9Ob2RlLCBvcHRpb25zKTsKCiAgICAgICAgICAgIAkJZnJvbS5zZXRPcGFjaXR5KDEpOwogICAgICAgICAgICAJCXRvLnNldE9wYWNpdHkoMCk7CgogICAgICAgICAgICAJCWZyb20uaW5zZXJ0KCk7CiAgICAgICAgICAgIAkJdG8uaW5zZXJ0KCk7CgogICAgICAgICAgICAJCS8vIFRoaXMgd2lsbCBmYWlsIGlmIGBmcm9tYCBpcyBpbnNpZGUgYSBkaWZmZXJlbnQgKGhpZ2hlcikKICAgICAgICAgICAgCQkvLyBzdGFja2luZyBjb250ZXh0IHRoYW4gYHRvYC4gTm90IG11Y2ggd2UgY2FuIGRvIMKvXF8o44OEKV8vwq8KICAgICAgICAgICAgCQl0by5zZXRaSW5kZXgoTWF0aC5tYXgodG8uZ2V0WkluZGV4KCksIGZyb20uZ2V0WkluZGV4KCkgKyAxKSk7CgogICAgICAgICAgICAJCXJldHVybiB0cmFuc2Zvcm1lcihmcm9tLCB0bywgb3B0aW9ucyk7CiAgICAgICAgICAgIAl9LAogICAgICAgICAgICAJaGlkZTogZnVuY3Rpb24gaGlkZSgpIHsKICAgICAgICAgICAgCQlmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgbm9kZXMgPSBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKICAgICAgICAgICAgCQkJbm9kZXNbX2tleV0gPSBhcmd1bWVudHNbX2tleV07CiAgICAgICAgICAgIAkJfQoKICAgICAgICAgICAgCQlub2Rlcy5mb3JFYWNoKGhpZGVOb2RlKTsKICAgICAgICAgICAgCX0sCiAgICAgICAgICAgIAlzaG93OiBmdW5jdGlvbiBzaG93KCkgewogICAgICAgICAgICAJCWZvciAodmFyIF9sZW4yID0gYXJndW1lbnRzLmxlbmd0aCwgbm9kZXMgPSBBcnJheShfbGVuMiksIF9rZXkyID0gMDsgX2tleTIgPCBfbGVuMjsgX2tleTIrKykgewogICAgICAgICAgICAJCQlub2Rlc1tfa2V5Ml0gPSBhcmd1bWVudHNbX2tleTJdOwogICAgICAgICAgICAJCX0KCiAgICAgICAgICAgIAkJbm9kZXMuZm9yRWFjaChzaG93Tm9kZSk7CiAgICAgICAgICAgIAl9LAoKICAgICAgICAgICAgCS8vIGV4cG9zZSBzb21lIGJhc2ljIGVhc2luZyBmdW5jdGlvbnMKICAgICAgICAgICAgCWxpbmVhcjogbGluZWFyLCBlYXNlSW46IGVhc2VJbiwgZWFzZU91dDogZWFzZU91dCwgZWFzZUluT3V0OiBlYXNlSW5PdXQsCgogICAgICAgICAgICAJLy8gVEVNUAogICAgICAgICAgICAJbWF0cml4OiBtYXRyaXgKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJldHVybiByYW1qZXQ7Cgp9KSk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPXJhbWpldC51bWQuanMubWFwCg=='></script>
	</head>

	<body>
		
		<article>
			<h1><a href='background-rgba-opacities.html'>background-rgba-opacities</a></h1>

			<div class='controls'>
				<button class='go'>go</button>
				<button class='show-all'>show start and end</button>

				<label>
					<input type='range' min='0' max='100' value='0'> <span class='range-value'>0</span>
				</label>
			</div>

			<!--<div class='test-area'>-->
				<p style='position: absolute'>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>

<div style='position: relative;'>
	<div class='a transparent'>a</div>
	<div class='b transparent'>b</div>
</div>

			<!--</div>-->

			<div class='screenshots'>
				
		<div class='screenshot-column'>
			<h2>actual</h2>

			<a href='../screenshots/background-rgba-opacities/actual/000.png'><img src='../screenshots/background-rgba-opacities/actual/000.png'></a>
<a href='../screenshots/background-rgba-opacities/actual/020.png'><img src='../screenshots/background-rgba-opacities/actual/020.png'></a>
<a href='../screenshots/background-rgba-opacities/actual/040.png'><img src='../screenshots/background-rgba-opacities/actual/040.png'></a>
<a href='../screenshots/background-rgba-opacities/actual/060.png'><img src='../screenshots/background-rgba-opacities/actual/060.png'></a>
<a href='../screenshots/background-rgba-opacities/actual/080.png'><img src='../screenshots/background-rgba-opacities/actual/080.png'></a>
<a href='../screenshots/background-rgba-opacities/actual/100.png'><img src='../screenshots/background-rgba-opacities/actual/100.png'></a>
		</div>
	

		<div class='screenshot-column'>
			<h2>expected</h2>

			<a href='../screenshots/background-rgba-opacities/expected/000.png'><img src='../screenshots/background-rgba-opacities/expected/000.png'></a>
<a href='../screenshots/background-rgba-opacities/expected/020.png'><img src='../screenshots/background-rgba-opacities/expected/020.png'></a>
<a href='../screenshots/background-rgba-opacities/expected/040.png'><img src='../screenshots/background-rgba-opacities/expected/040.png'></a>
<a href='../screenshots/background-rgba-opacities/expected/060.png'><img src='../screenshots/background-rgba-opacities/expected/060.png'></a>
<a href='../screenshots/background-rgba-opacities/expected/080.png'><img src='../screenshots/background-rgba-opacities/expected/080.png'></a>
<a href='../screenshots/background-rgba-opacities/expected/100.png'><img src='../screenshots/background-rgba-opacities/expected/100.png'></a>
		</div>
	

		<div class='screenshot-column'>
			<h2>diff</h2>

			<a href='../screenshots/background-rgba-opacities/diff/000.png'><img src='../screenshots/background-rgba-opacities/diff/000.png'></a>
<a href='../screenshots/background-rgba-opacities/diff/020.png'><img src='../screenshots/background-rgba-opacities/diff/020.png'></a>
<a href='../screenshots/background-rgba-opacities/diff/040.png'><img src='../screenshots/background-rgba-opacities/diff/040.png'></a>
<a href='../screenshots/background-rgba-opacities/diff/060.png'><img src='../screenshots/background-rgba-opacities/diff/060.png'></a>
<a href='../screenshots/background-rgba-opacities/diff/080.png'><img src='../screenshots/background-rgba-opacities/diff/080.png'></a>
<a href='../screenshots/background-rgba-opacities/diff/100.png'><img src='../screenshots/background-rgba-opacities/diff/100.png'></a>
		</div>
	
			</div>
		</article>
	

		<script>
			[].forEach.call( document.querySelectorAll( 'article' ), function ( article ) {
				var go = article.querySelector( '.go' );
				var showAll = article.querySelector( '.show-all' );
				var range = article.querySelector( 'input' );
				var rangeValue = article.querySelector( '.range-value' );

				var a = article.querySelector( '.a' ) || article.querySelector( '[data-a]' );
				var b = article.querySelector( '.b' ) || article.querySelector( '[data-b]' );

				var reversed;
				var animatedTransformer;
				var staticTransformer;

				ramjet.hide( b );

				go.addEventListener( 'click', function ( event ) {
					var from = reversed ? b : a;
					var to = reversed ? a : b;

					go.disabled = true;

					ramjet.show( a, b );

					if ( staticTransformer ) staticTransformer.teardown();

					animatedTransformer = ramjet.transform( from, to, {
						duration: 1000,
						done: function () {
							go.disabled = false;
							reversed = !reversed;
							ramjet.show( to );
						}
					});

					ramjet.hide( a, b );
				});

				showAll.addEventListener( 'click', function ( event ) {
					ramjet.show( a, b );
				});

				range.addEventListener( 'input', function ( event ) {
					if ( animatedTransformer ) animatedTransformer.teardown();

					if ( !staticTransformer ) {
						ramjet.show( a, b );
						staticTransformer = ramjet.transform( a, b ).pause();
						ramjet.hide( a, b );
					}

					staticTransformer.goto( +range.value / 100 );
					rangeValue.textContent = range.value;
				});
			});
		</script>
	</body>
</html>
